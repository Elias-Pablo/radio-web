---
const API_KEY = "YOUR_API_KEY";

const comunas = [
  { name: "Rengo", id: 3873441 },
  { name: "Rancagua", id: 3873775 },
  { name: "Pichilemu", id: 3875070 },
  { name: "Requínoa", id: 3873414 },
  { name: "Coinco", id: 3873441 },
  { name: "Coltauco", id: 3893999 },
  { name: "Doñihue", id: 3892272 },
];

async function fetchWeatherData(comunaId) {
  try {
    const response = await fetch(
      `https://api.openweathermap.org/data/2.5/weather?id=${comunaId}&appid=${import.meta.env.OPENWEATHER_API_KEY}&units=metric&lang=es`
    );

    // Verificar si la respuesta es exitosa
    if (!response.ok) {
      throw new Error("Error fetching weather data");
    }

    const data = await response.json();
    return data;
  } catch (error) {
    console.error("Error fetching weather data for ID:", comunaId, error);
    return null; // Retornar null en caso de error
  }
}

const weatherData = await Promise.all(
  comunas.map((comuna) => fetchWeatherData(comuna.id))
);
---

<div class="bg-blue-300 shadow-md p-6">
  <h1 class="text-2xl text-white font-semibold mb-6 text-center">
    Clima en la Región de O'Higgins
  </h1>

  {
    weatherData.length > 0 ? (
      <div class="grid grid-cols-4 md:grid-cols-4 lg:grid-cols-7 gap-4">
        {weatherData.map((data, index) => (
          <div class="bg-sky-200 p-2 rounded-lg ">
            <h3 class="text-md font-bold mb-2">{comunas[index].name}</h3>
            {data ? (
              <>
                {/* URL del icono */}
                <img
                  src={`http://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`}
                  alt={data.weather[0].description}
                  class="mb-2 w-20 h-20"
                />
                <p class="text-sm">Temperatura: {data.main?.temp}°C</p>
                <p class="text-sm">
                  Clima: {data.weather?.[0]?.description || "No disponible"}
                </p>
              </>
            ) : (
              <p class="text-gray-500">Error al cargar datos del clima</p>
            )}
          </div>
        ))}
      </div>
    ) : (
      <p class="text-gray-500">Cargando datos del clima...</p>
    )
  }
</div>
